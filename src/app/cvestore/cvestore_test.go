package cvestore

import (
	"testing"
	"time"

	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"

	"appengine/aetest"
)

func TestPutExist(t *testing.T) {
	ctx, err := aetest.NewContext(nil)
	if err != nil {
		t.Fatal(err)
	}
	defer ctx.Close()

	in := Item{
		CVE:     "test-id",
		Product: "test_product",
		Summary: "This is a test summary.",
		Link:    "https://example.com",
		Date:    time.Date(2009, time.November, 10, 23, 0, 0, 0, time.UTC),
	}

	assert.NoError(t, Put(ctx, in))
	assert.NoError(t, Put(ctx, in)) // Duplicate will overwrite

	testCases := []struct {
		id    string
		found bool
	}{
		{"test-id", true},
		{"unknown-id", false},
	}

	for _, tc := range testCases {
		actual, err := Exist(ctx, tc.id)
		require.NoError(t, err)
		assert.Equal(t, tc.found, actual)
	}
}
